<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides" id="slides">

			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			function decodeJsonDataCookie() {
				const cookieValue = document.cookie.replace(/(?:(?:^|.*;)jsonData=([^;]*))|(?:^.*)$/, "$1");

				if (!cookieValue) {
					return null;
				}

				try {
					const decodedString = atob(cookieValue);
					const jsonData = JSON.parse(decodedString);
					return jsonData;
				} catch (error) {
					console.error("Error decoding jsonData cookie:", error);
					return null;
				}
			}

			function htmlEncode(str) {
				let tempDiv = document.createElement('div');
				tempDiv.innerText = str;
				return tempDiv.innerHTML;
			}

			let slidesList = decodeJsonDataCookie();
			let slidesDiv = document.getElementById("slides");

			for (const slideData of slidesList) {
				let wholeSection = document.createElement("section");
				let questionSection = document.createElement("section");
				questionSection.classList.add("slide");

				let number = 1;
				if (slideData.question.length >= 120) number = 2;
				let questionHtml = `
				<div>
					<h2 style="font-size: calc(50vh / calc(18 * ${number}))">${htmlEncode(slideData.question)}</h2>
					<p style="font-size: 0.5em; color: grey">${htmlEncode(slideData.category)} / ${htmlEncode(slideData.type)}</p>
				</div>
				<div class="${slideData.options ? "fragment" : ""}">
					<ul>`;
				if (slideData.options) {
					for (const option of slideData.options) {
						questionHtml += `<li>${htmlEncode(option)}</li>`;
					}
				}
				questionHtml += `</ul></div>`;
				questionSection.innerHTML = questionHtml;

				wholeSection.appendChild(questionSection);

				let answerSection = document.createElement("section");
				answerSection.classList.add("slide");

				answerSection.innerHTML = `
					<h2>Answer</h2>
					<p><b>${htmlEncode(slideData.answer)}</b></p>
					<p><i>(${htmlEncode(slideData.explanation_answer)})</i></p>
				  `;

				wholeSection.appendChild(answerSection);
				slidesDiv.appendChild(wholeSection);
			}

			let sectionEnd = document.createElement("section");
			sectionEnd.innerHTML = `
			<a href="/index.html" class="btn btn-primary text-white">Play again</a>
			`;
			slidesDiv.appendChild(sectionEnd);

			Reveal.initialize({
				hash: true,
				plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
			});
		</script>

	</body>
</html>
